<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.11.6/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega@5.20.2"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.5.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.18.2"></script>
    <style>
        body {
            padding: 20px;
        }
        form {
            max-width: 500px;
            margin-bottom: 30px;
        }
        label {
            display: block;
            margin-top: 10px;
        }
        input[type="submit"] {
            margin-top: 20px;
        }
        table {
            width: 100%;
            margin-top: 30px;
        }
        .table-smaller-rows th,
        .table-smaller-rows td {
            padding: 4px 8px;
            font-size: 0.8rem;
        }
        .scrollable-table {
            display: block;
            max-height: 800px; /* Adjust this value according to your desired maximum table height */
            overflow-y: scroll;
        }

        .scrollable-table thead th {
            position: sticky;
            top: 0;
            background-color: #f8f9fa; /* Adjust this value to match your table header background color */
            z-index: 10;
        }

    </style>
    <title>Retirement Calculator</title>
</head>
<body>
    <h1>WenFire â‰ï¸ğŸ”¥</h1>
    <h2>Financial Independence Calculator</h2>
        <details>
            Welcome to the ğŸ”¥ FIRE Calculator ğŸ”¥! Financial Independence, Retire Early (FIRE) is a movement that aims to help you achieve financial freedom and retire before the traditional retirement age. Our calculator will help you visualize your journey towards financial independence. But before you dive in, here are some assumptions and limitations to keep in mind:
            <ol>
            <li>ğŸ’¹ Investment Growth: The calculator assumes a fixed annual growth rate for your investments. While historically, the stock market has had an average annual return of around 7%, it's important to remember that past performance doesn't guarantee future results. Market conditions can change, and your actual returns might be different.</li>
            <li>ğŸ’° Inflation: We factor in inflation as a constant rate throughout your journey. In reality, inflation rates can vary over time, affecting your spending power differently.</li>
            <li>ğŸ“ˆ Salary Increases: The calculator assumes that your salary will increase at a constant rate every year. However, life can be unpredictable, and changes in your career or job market can impact your income growth.</li>
            <li>ğŸ›ï¸ Spending: Your monthly spending is assumed to be constant, adjusted for inflation. In real life, your expenses might change as your lifestyle evolves or due to unexpected events.</li>
            <li>ğŸ’µ Safe Withdrawal Rate: We use the popular 4% rule, which assumes that you can withdraw 4% of your portfolio annually without running out of money in retirement. Keep in mind that this rule is based on historical data, and future market conditions might require adjustments to your withdrawal rate.</li>
            </ol>
            Remember, this calculator is a ğŸ› ï¸ tool to help you get a rough estimate of your journey to financial independence. It's essential to regularly review and adjust your financial plans based on your personal situation and the ever-changing world around us. Stay curious, keep learning, and always be prepared to adapt! ğŸ˜ƒ
        </details>

    {% macro form_field(label, field_id, field_name, field_value, field_type='number', step=None, help_text='') %}
    <div class="col-md-6">
        <label for="{{ field_id }}">{{ label }}:</label>
        <input type="{{ field_type }}" id="{{ field_id }}" name="{{ field_name }}" value="{{ field_value }}" {% if step %}step="{{ step }}"{% endif %} required class="form-control">
        {% if help_text %}
            <small id="{{ field_id }}Help" class="form-text text-muted">{{ help_text }}</small>
        {% endif %}
    </div>
    {% endmacro %}

    <form action="/calculate" method="get">
        <div class="row">
            {{ form_field('Growth Rate', 'growth_rate', 'growth_rate', growth_rate, 'number', '0.1', 'Enter the expected annual growth rate for investments (e.g., 7 for 7%).') }}
            {{ form_field('Current Net Worth', 'current_nw', 'current_nw', current_nw, help_text='Enter your current net worth (incl retirement plans like 401k).') }}
        </div>
        <div class="row">
            {{ form_field('Annual Salary Increase', 'annual_salary_increase', 'annual_salary_increase', annual_salary_increase, 'number', '0.1', 'Enter the expected annual salary increase percentage (e.g., 5 for 5%).') }}
            {{ form_field('Income per Month', 'income_per_month', 'income_per_month', income_per_month, help_text='Enter your monthly income after taxes.') }}
        </div>
        <div class="row">
            {{ form_field('Inflation', 'inflation', 'inflation', inflation, 'number', '0.1', 'Enter the expected annual inflation rate (e.g., 2 for 2%).') }}
            {{ form_field('Spending per Month', 'spending_per_month', 'spending_per_month', spending_per_month, help_text='Enter your average monthly spending.') }}
        </div>
        <div class="row">
            {{ form_field('Date of Birth', 'date_of_birth', 'date_of_birth', date_of_birth, 'date', help_text='Enter your date of birth.') }}
            {{ form_field('Extra Income', 'extra_income', 'extra_income', extra_income, help_text='Enter any extra monthly income (e.g., side job, rental income).') }}
        </div>
        <input type="submit" value="Calculate" class="btn btn-primary">
    </form>

{% if summary %}
<table class="table table-striped table-bordered table-smaller-rows">
    <thead>
        <tr>
            <th>Which</th>
            <th>Value</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Current Age ğŸ‘¨â€ğŸ’»</td>
            <td>{{ summary.age | round(1) }} years</td>
        </tr>
        <tr>
            <td>Retirement Age ğŸ“…</td>
            <td>{{ summary.fire_age | round(1) }} years</td>
        </tr>
        <tr>
            <td>Fire date ğŸ“…</td>
            <td>{{ summary.fire_date }}</td>
        </tr>
        <tr>
            <td>Years to FI ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥</td>
            <td>{{ summary.years_till_fi | round(1) }} years</td>
        </tr>
        <tr>
            <td>Safe Withdraw at FI ğŸ¤‘</td>
            <td>${{ (summary.safe_withdraw_at_fi / 1000) | int }}k</td>
        </tr>
        <tr>
            <td>Spending at FI ğŸ’°</td>
            <td>${{ (summary.spending_at_fi / 1000) | int }}k</td>
        </tr>
        <tr>
            <td>NW at FI ğŸ”¥</td>
            <td>${{ (summary.nw_at_fi / 1e6) | round(2) }}M</td>
        </tr>
        {% if summary.safe_withdraw_at_35 is not none %}
        <tr>
            <td>Safe Withdraw at 35 ğŸ‘€ï¸ğŸ’°</td>
            <td>{{ summary.safe_withdraw_at_35 | int }}</td>
        </tr>
        {% endif %}
        {% if summary.safe_withdraw_at_40 is not none %}
        <tr>
            <td>Safe Withdraw at 40 ğŸ‘€ï¸ğŸ’°</td>
            <td>{{ summary.safe_withdraw_at_40 | int }}</td>
        </tr>
        {% endif %}
        {% if summary.safe_withdraw_at_45 is not none %}
        <tr>
            <td>Safe Withdraw at 45 ğŸ‘€ï¸ğŸ’°</td>
            <td>{{ summary.safe_withdraw_at_45 | int }}</td>
        </tr>
        {% endif %}
    </tbody>
</table>
{% endif %}


{% if results %}
    <!-- Create div elements to hold the plots -->
    <div id="age-vs-net-worth-plot"></div>
    <div id="age-vs-monthly-safe-withdraw-plot"></div>
    <div id="savings-vs-spending-plot"></div>

    <!-- Add the JavaScript code to render the plots -->
    <script>
    const ageVsNetWorthPlotSpec = JSON.parse({{ age_vs_net_worth_plot|tojson|safe }});
    const ageVsMonthlySafeWithdrawPlotSpec = JSON.parse({{ age_vs_monthly_safe_withdraw_plot|tojson|safe }});
    const savingsVsSpendingPlotSpec = JSON.parse({{ savings_vs_spending_plot|tojson|safe }});

    vegaEmbed("#age-vs-net-worth-plot", ageVsNetWorthPlotSpec);
    vegaEmbed("#age-vs-monthly-safe-withdraw-plot", ageVsMonthlySafeWithdrawPlotSpec);
    vegaEmbed("#savings-vs-spending-plot", savingsVsSpendingPlotSpec);
    </script>

    <div class="scrollable-table">
    <table class="table table-striped table-bordered table-smaller-rows">
        <thead>
            <tr>
                <th># months</th>
                <th># years</th>
                <th>Age</th>
                <th>NW</th>
                <th>Î”NW</th>
                <th>Saving</th>
                <th>Income</th>
                <th>Investment profits</th>
                <th>Spending</th>
                <th>Safe withdraw</th>
                <th>Safe - spending</th>
            </tr>
        </thead>
        <tbody>
            {% for result in results %}
                <tr>
                    <td>{{ result.months }} months</td>
                    <td>{{ result.years | round(1) }} years</td>
                    <td>{{ result.age | round(1) }} years</td>
                    <td>${{ result.nw | int }}</td>
                    <td>${{ result.delta_nw | int }}</td>
                    <td>${{ result.saving | int }}</td>
                    <td>${{ result.income | int }}</td>
                    <td>${{ result.investment_profits | int }}</td>
                    <td>${{ result.spending | int }}</td>
                    <td>${{ result.safe_withdraw_rule_monthly | int }}</td>
                    <td bgcolor={{ "#86af49" if result.safe_withdraw_minus_spending > 0 else "#eca1a6" }}>{{ result.safe_withdraw_minus_spending | int }}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    </div>
{% endif %}
</body>
</html>
